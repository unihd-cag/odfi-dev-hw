<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Package Viewer</title>

<!-- Bootstrap Styles -->
<!-- ################ -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet"
    media="screen" />

<script type="text/javascript" src="http://code.jquery.com/jquery-2.0.3.min.js" ></script>

<!-- Viewer Styles -->
<!-- ############ -->
<style type="text/css">



</style>

</head>
<body>

<h1>Package Viewer</h1>
<p>

This small web page will help view available packages and their actual rendering through different output generators

</p>

<p>
    Current Package: <span id="current-package"></span>
</p>


<!-- Content -->
<!-- ####### -->
<div class="row-fluid">

    <!-- Producer Output -->
    <!-- ############### -->
    <div class="span6">
        <h3>Producer Output</h3>

            <div  id="producer-output"></div>
 
        
    </div>

    <!-- Control part -->
    <!-- ############### -->
    <div class="span6">
        <h3>Controls</h3>

        <div>
            <h4>Producer Control</h4>
            <form id="producer-select">

                <input type="radio" name="producer" value="svg">SVG Output<br/>
                <input type="radio" name="producer" value="capture">Capture
                <div>
                    <div>Rules:</div>
                    <textarea rows="25" style="width: 100%" name="rules"></textarea>
                </div>
                <div>
                    <input type="button" value="preview"></input>
                    <input type="button" value="save"></input>
                </div>
            </form>
            <script>
                // For each possible Producer, add a call to update the producer output div
                //-----------
                $("#producer-select input:radio").each(function(i,input) {

                    $(input).change(function(obj){

                        console.log("clicked input element")
                        $("#producer-output").text("Loading....")

                        console.log("Rules: "+$("#producer-select textarea").serialize())

                        //$("#producer-output").load("/package/data/producer/produce?view=svg",{"rules": $("#producer-select textarea").text()})
                        $("#producer-output").load("/package/data/producer/produce?view=svg&"+$("#producer-select textarea").serialize())

                    })
                    

                })
            </script
        </div>

        <div>
            <h4>Package Informations</h4>


            <%
                ## Pins 
                table {

                    set id "package-infos-pins"
                    header {
                        column "Pin Name"
                    }

                    body {

                      foreach {location pin} [[$application currentPackage] getPinsArray] {  
                        row [$pin name]
                      }

                    }
                }
            %>
        </div>

    </div>

</div>


<script type="text/javascript">
    
    // Init
    //--------------
    $( function() {

        // Update Selected Package
        //----------------------
        $.ajax({
            url: "/package/data/package/current",
            dataType: "json",
            success: function(data) {

                console.log("Updated current package: "+data)

                $("#current-package").text(data.result)
            },
            error: function(xqr,status) {

                console.log("error: "+status)
            }

        })

    } )

</script>

</body>
</html>
